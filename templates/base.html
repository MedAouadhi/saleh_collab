<!DOCTYPE html>
<html lang="ar" dir="rtl"> {# Set language to Arabic and direction to RTL #}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ÙƒØ§ØªØ¨ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    {# Add Arabic fonts #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet"> {# Added font-weight 700 #}
    <style>
        /* Apply General Arabic font */
        body {
            font-family: 'Tajawal', sans-serif;
        }
        /* Apply Specific Arabic font for Plan/Scenario Textareas */
        #plan-area, #scenario-area {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            font-size: 1rem; /* Adjust size as needed */
            line-height: 1.6; /* Improve readability */
        }
        /* Apply Specific Arabic font for Scenario Display Div */
        /* Target both the ID and the class for specificity */
        #scenario-display, #plan-display, .font-mono { /* Added #plan-display */
             font-family: 'IBM Plex Sans Arabic', monospace;
             font-size: 0.95rem; /* Slightly smaller for display? Adjust as needed */
             line-height: 1.6;
        }

        /* --- Overrides for Tailwind Prose within Scenario/Plan Display --- */
        #scenario-display.prose h1, #plan-display.prose h1 {
            font-size: 1.875rem; /* Tailwind text-3xl */
            font-weight: 700; /* Bold */
            margin-bottom: 0.8em; margin-top: 1em; color: #1f2937; /* gray-800 */
        }
        #scenario-display.prose h2, #plan-display.prose h2 {
            font-size: 1.5rem; /* Tailwind text-2xl */
            font-weight: 700; margin-bottom: 0.7em; margin-top: 0.9em; color: #1f2937;
        }
        #scenario-display.prose h3, #plan-display.prose h3 {
            font-size: 1.25rem; /* Tailwind text-xl */
            font-weight: 700; margin-bottom: 0.6em; margin-top: 0.8em; color: #1f2937;
        }
         #scenario-display.prose h4, #plan-display.prose h4 {
            font-size: 1.125rem; /* Tailwind text-lg */
            font-weight: 700; margin-bottom: 0.5em; margin-top: 0.7em; color: #1f2937;
        }
        #scenario-display.prose p, #plan-display.prose p {
            margin-top: 0.5em; margin-bottom: 0.5em;
        }
        #scenario-display.prose ul, #plan-display.prose ul,
        #scenario-display.prose ol, #plan-display.prose ol {
            margin-top: 0.8em; margin-bottom: 0.8em; padding-right: 1.5em; padding-left: 0;
        }
        #scenario-display.prose ul, #plan-display.prose ul { list-style-type: disc; }
        #scenario-display.prose ol, #plan-display.prose ol { list-style-type: decimal; }
        #scenario-display.prose li, #plan-display.prose li { margin-top: 0.25em; margin-bottom: 0.25em; }
        #scenario-display.prose li > p, #plan-display.prose li > p { margin-top: 0; margin-bottom: 0; }

        /* --- RTL Table Styling --- */
        #scenario-display.prose table,
        #plan-display.prose table {
            direction: rtl; /* <<< ADDED THIS to force column order */
            width: auto; /* Allow table to size naturally or set to 100% */
            margin-top: 1em;
            margin-bottom: 1em;
            border-collapse: collapse;
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        #scenario-display.prose th,
        #scenario-display.prose td,
        #plan-display.prose th,
        #plan-display.prose td {
            text-align: right !important; /* Force RTL text alignment */
            border: 1px solid #e5e7eb; /* gray-200 */
            padding: 0.5rem 0.75rem; /* Tailwind p-2 px-3 equivalent */
        }
         #scenario-display.prose th,
         #plan-display.prose th {
             background-color: #f9fafb; /* gray-50 */
             font-weight: 600; /* semibold */
         }
        /* --- End Prose Overrides --- */


        /* Styling for commentable blocks */
        .commentable-block {
            cursor: pointer;
            padding: 2px 5px; margin: 2px 0; border-radius: 3px;
            transition: background-color 0.2s ease; position: relative;
        }
        .commentable-block:hover { background-color: #f0f4f8; }
        .commentable-block.has-comments::after {
            content: 'ğŸ’¬'; position: absolute; left: 5px; right: auto;
            top: 5px; font-size: 0.7em; opacity: 0.6; z-index: 1;
        }

        /* General Styles */
        .btn-hover-effect { transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out; }
        .btn-hover-effect:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .flash-message { transition: opacity 0.5s ease-out; }
        .comment-section { max-height: 400px; overflow-y: auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .comment-item { animation: fadeIn 0.3s ease-out; }
        .delete-comment-btn { background: none; border: none; color: #f56565; cursor: pointer; font-size: 0.8em; padding: 0 3px; margin-right: 5px; opacity: 0.6; transition: opacity 0.2s ease; }
        .delete-comment-btn:hover { opacity: 1; color: #c53030; }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <nav class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-md">
        {# ... Navbar content ... #}
         <div class="container mx-auto flex justify-between items-center">
            <a href="{{ url_for('dashboard') }}" class="text-2xl font-bold hover:text-blue-200 transition duration-200">ğŸ“ ÙƒØ§ØªØ¨ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ</a>
            <div>
                {% if current_user.is_authenticated %}
                    <span class="ml-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {{ current_user.username }}!</span> {# Changed mr-4 to ml-4 #}
                    <a href="{{ url_for('logout') }}" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded btn-hover-effect">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded btn-hover-effect">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container mx-auto mt-8 p-4">
        {# ... Flash messages ... #}
         {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4">
                {% for category, message in messages %}
                    <div class="flash-message p-4 rounded mb-2 text-right {# Ensure text aligns right #}
                        {% if category == 'danger' %} bg-red-100 border border-red-400 text-red-700
                        {% elif category == 'success' %} bg-green-100 border border-green-400 text-green-700
                        {% elif category == 'warning' %} bg-yellow-100 border border-yellow-400 text-yellow-700
                        {% else %} bg-blue-100 border border-blue-400 text-blue-700 {% endif %}"
                        role="alert"
                        x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 3000)"> {{ message }}
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer class="text-center text-gray-500 text-sm mt-12 mb-4">
        &copy; {{ now().year }} ÙƒØ§ØªØ¨ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    {# Optional: Add html2canvas if complex HTML rendering is needed later #}
    {# <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> #}


    {# This allows pages like episode.html to define variables like EPISODE_ID #}
    {% block scripts %}{% endblock %}

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>
